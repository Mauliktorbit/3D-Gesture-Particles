<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Gesture Particles | The Coding Mann</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/hands.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    
    <style>
        :root { 
            --neon: #00ffcc; 
            --danger: #ff4a4a; 
            --glass: rgba(255, 255, 255, 0.07);
            --border: rgba(255, 255, 255, 0.15);
        }

        body { 
            margin: 0; 
            overflow: hidden; 
            background: radial-gradient(circle at center, #111 0%, #000 100%); 
            font-family: 'Inter', system-ui, sans-serif; 
            color: white; 
        }

        /* --- UI LAYER --- */
        #ui-container {
            position: absolute;
            inset: 0;
            pointer-events: none;
            padding: 25px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            z-index: 100;
        }
        #ui-container > * { pointer-events: auto; }

        /* Header: Status & Branding */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        #scanner {
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--glass);
            backdrop-filter: blur(15px);
            padding: 12px 20px;
            border-radius: 50px;
            border: 1px solid var(--border);
        }
        .dot { 
            width: 10px; height: 10px; border-radius: 50%; 
            background: var(--danger); box-shadow: 0 0 10px var(--danger); 
            transition: 0.3s ease;
        }
        .dot.active { background: var(--neon); box-shadow: 0 0 15px var(--neon); }
        .status-text { font-size: 11px; font-weight: 800; letter-spacing: 1.5px; color: var(--danger); text-transform: uppercase; }
        .status-text.active { color: var(--neon); }

        .brand-container {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            text-align: right;
        }
        .og-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 3px;
            color: rgba(255, 255, 255, 0.4);
            margin-bottom: -2px;
            font-weight: 600;
        }
        .handle-text { 
            color: var(--neon); 
            font-size: 1.4rem; 
            font-weight: 900; 
            text-shadow: 0 0 15px rgba(0, 255, 204, 0.4);
            text-decoration: none;
        }

        /* Sidebar: Shape List */
        #sidebar {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: fit-content;
        }
        .shape-item {
            padding: 14px 20px;
            border-radius: 12px;
            font-size: 13px;
            background: var(--glass);
            border: 1px solid var(--border);
            color: rgba(255, 255, 255, 0.5);
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-width: 180px;
            cursor: pointer;
        }
        .shape-item.active { 
            background: rgba(0, 255, 204, 0.15); 
            border-color: var(--neon); 
            color: white; 
            transform: translateX(15px);
            box-shadow: -5px 0 20px rgba(0, 255, 204, 0.1);
        }
        .hint { font-size: 9px; opacity: 0.4; font-weight: normal; margin-left: 10px; }

        /* Footer: Screenshot & Camera */
        .footer {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }

        #screenshot-btn {
            width: 65px; height: 65px; border-radius: 50%;
            background: var(--glass); border: 2px solid var(--neon);
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: 0.3s; backdrop-filter: blur(10px);
        }
        #screenshot-btn:hover { background: var(--neon); transform: scale(1.1) rotate(5deg); }
        #screenshot-btn svg { fill: var(--neon); }
        #screenshot-btn:hover svg { fill: #000; }

        #webcam-preview {
            width: 160px; aspect-ratio: 4/3; border-radius: 15px;
            border: 1px solid var(--border); transform: scaleX(-1);
            background: #111; object-fit: cover;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        /* --- RESPONSIVE DESIGN --- */
        @media (max-width: 768px) {
            #ui-container { padding: 15px; }
            .handle-text { font-size: 1.1rem; }
            
            #sidebar {
                flex-direction: row;
                overflow-x: auto;
                width: 100%;
                padding-bottom: 10px;
                gap: 8px;
                scrollbar-width: none;
            }
            #sidebar::-webkit-scrollbar { display: none; }
            
            .shape-item {
                min-width: 110px;
                flex-shrink: 0;
                transform: none !important;
                justify-content: center;
                font-size: 11px;
                padding: 10px;
            }
            .hint { display: none; }

            #webcam-preview {
                width: 100px;
                position: fixed;
                top: 85px;
                right: 15px;
            }
        }
    </style>
</head>
<body>

<div id="ui-container">
    <div class="header">
        <div id="scanner">
            <div id="status-dot" class="dot"></div>
            <div id="status-label" class="status-text">Scanning...</div>
        </div>
        
        <div class="brand-container">
            <span class="og-label">OG Creator</span>
            <a href="https://www.instagram.com/the_coding_mann/" target="_blank" class="handle-text">@The_Coding_Mann</a>
        </div>
    </div>

    <div id="sidebar">
        <div class="shape-item" id="list-fireworks">Fireworks <span class="hint">1 Finger</span></div>
        <div class="shape-item active" id="list-heart">Heart <span class="hint">2 Fingers</span></div>
        <div class="shape-item" id="list-saturn">Saturn <span class="hint">3 Fingers</span></div>
        <div class="shape-item" id="list-flower">Flower <span class="hint">4 Fingers</span></div>
    </div>

    <div class="footer">
        <button id="screenshot-btn" title="Take Screenshot">
            <svg width="26" height="26" viewBox="0 0 24 24"><path d="M4 4h3l2-2h6l2 2h3a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2zm8 3a5 5 0 1 0 0 10 5 5 0 0 0 0-10zm0 2a3 3 0 1 1 0 6 3 3 0 0 1 0-6z"/></svg>
        </button>
        <video id="webcam-preview" autoplay playsinline muted></video>
    </div>
</div>

<video id="input_video" style="display:none"></video>

<script type="module">
    import * as THREE from 'https://cdn.skypack.dev/three@0.136.0';

    const videoElement = document.getElementById('input_video');
    const previewElement = document.getElementById('webcam-preview');
    const statusDot = document.getElementById('status-dot');
    const statusLabel = document.getElementById('status-label');

    // --- THREE.JS ENGINE ---
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true, preserveDrawingBuffer: true });
    
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);
    
    camera.position.z = window.innerWidth < 768 ? 8 : 6;

    let points;
    let currentShapeType = 'heart';
    const PARTICLE_COUNT = window.innerWidth < 768 ? 10000 : 20000;
    const material = new THREE.PointsMaterial({ 
        size: 0.03, 
        transparent: true, 
        blending: THREE.AdditiveBlending,
        depthWrite: false 
    });

    // --- SHAPE GENERATOR ---
    function generateShape(type) {
        const pos = new Float32Array(PARTICLE_COUNT * 3);
        for(let i=0; i<PARTICLE_COUNT; i++) {
            let x, y, z;
            if(type === 'heart') {
                const t = Math.random() * Math.PI * 2;
                x = 16 * Math.pow(Math.sin(t), 3) * 0.12;
                y = (13*Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t)) * 0.12;
                z = (Math.random()-0.5) * 0.5;
            } else if(type === 'flower') {
                const t = Math.random() * Math.PI * 2;
                const r = 2.5 * Math.cos(5 * t);
                x = r * Math.cos(t); y = r * Math.sin(t); z = (Math.random()-0.5);
            } else if(type === 'saturn') {
                if(i < PARTICLE_COUNT*0.5) {
                    const u = Math.random(); const v = Math.random();
                    const t = 2*Math.PI*u; const p = Math.acos(2*v-1);
                    x = Math.sin(p)*Math.cos(t)*1.6; y = Math.sin(p)*Math.sin(t)*1.6; z = Math.cos(p)*1.6;
                } else {
                    const r = 2.2 + Math.random() * 1.8; const t = Math.random() * Math.PI * 2;
                    x = r*Math.cos(t); y = r*Math.sin(t)*0.15; z = r*Math.sin(t);
                }
            } else { // Fireworks
                const r = Math.pow(Math.random(), 0.5) * 4.5;
                const theta = Math.random() * Math.PI * 2;
                const phi = Math.random() * Math.PI;
                x = r * Math.sin(phi) * Math.cos(theta); y = r * Math.sin(phi) * Math.sin(theta); z = r * Math.cos(phi);
            }
            pos[i*3] = x; pos[i*3+1] = y; pos[i*3+2] = z;
        }
        const geo = new THREE.BufferGeometry();
        geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
        return geo;
    }

    points = new THREE.Points(generateShape('heart'), material);
    scene.add(points);

    // --- UI UPDATER ---
    function updateListUI(type) {
        document.querySelectorAll('.shape-item').forEach(item => item.classList.remove('active'));
        const activeItem = document.getElementById(`list-${type}`);
        if(activeItem) {
            activeItem.classList.add('active');
            if(window.innerWidth < 768) {
                activeItem.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
            }
        }
    }

    // --- GESTURE ENGINE ---
    const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
    hands.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.7, minTrackingConfidence: 0.7 });
    
    hands.onResults((res) => {
        if(res.multiHandLandmarks && res.multiHandLandmarks.length > 0) {
            statusDot.classList.add('active');
            statusLabel.classList.add('active');
            statusLabel.innerText = "System Active";

            const h = res.multiHandLandmarks[0];
            material.color.setHSL(h[9].x, 0.8, 0.5);
            
            const fingersUp = [8, 12, 16, 20].filter(id => h[id].y < h[id-2].y).length;
            let newType = currentShapeType;
            if(fingersUp === 1) newType = 'fireworks';
            else if(fingersUp === 2) newType = 'heart';
            else if(fingersUp === 3) newType = 'saturn';
            else if(fingersUp === 4) newType = 'flower';

            if(newType !== currentShapeType) {
                currentShapeType = newType;
                points.geometry.dispose();
                points.geometry = generateShape(newType);
                updateListUI(newType);
            }
            const dist = Math.hypot(h[4].x - h[8].x, h[4].y - h[8].y);
            const targetScale = (window.innerWidth < 768 ? 0.35 : 0.5) + (dist * 10);
            points.scale.lerp(new THREE.Vector3(targetScale, targetScale, targetScale), 0.1);
        } else {
            statusDot.classList.remove('active');
            statusLabel.classList.remove('active');
            statusLabel.innerText = "Hand Scanning...";
        }
    });

    // --- UTILITIES ---
    document.getElementById('screenshot-btn').onclick = () => {
        const link = document.createElement('a');
        link.download = `TheCodingMann-Art-${Date.now()}.png`;
        link.href = renderer.domElement.toDataURL('image/png');
        link.click();
    };

    async function startCamera() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            videoElement.srcObject = stream;
            previewElement.srcObject = stream;
            const cameraTrack = new Camera(videoElement, {
                onFrame: async () => { await hands.send({image: videoElement}); },
                width: 640, height: 480
            });
            cameraTrack.start();
        } catch (err) {
            statusLabel.innerText = "Camera Error";
        }
    }
    startCamera();

    function animate() {
        requestAnimationFrame(animate);
        points.rotation.y += 0.005;
        renderer.render(scene, camera);
    }
    animate();

    window.onresize = () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
        camera.position.z = window.innerWidth < 768 ? 8 : 6;
    };
</script>
</body>
</html>